<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Website RT 05 - Beranda</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <header>
    <h1>Selamat Datang di RT 05</h1>
    <nav>
      <ul>
        <li><a href="index.html">Beranda</a></li>
        <li><a href="profil.html">Profil RT</a></li>
        <li><a href="data-warga.html">Data Warga</a></li>
        <li><a href="pengumuman.html">Pengumuman</a></li>
        <li><a href="galeri.html">Galeri</a></li>
        <li><a href="kontak.html">Kontak</a></li>
      </ul>
    </nav>
  </header>

  <h2>Daftar Pembayaran Jimpitan</h2>
  <table id="tabelJimpitan">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    const tabel = document.getElementById("tabelPembayaran");
const inputBulan = document.getElementById("bulan");

let dataAsli = []; // data dari fetch

// Ambil data dari Google Apps Script
fetch("https://script.google.com/macros/s/AKfycb.../exec")
  .then(res => res.json())
  .then(data => {
    dataAsli = data;
    tampilkanTabel(data);
  });

inputBulan.addEventListener("change", () => {
  const bulanDipilih = inputBulan.value; // format: "2025-07"
  if (!bulanDipilih) return;

  const [tahun, bulan] = bulanDipilih.split("-");
  const dataFiltered = dataAsli.map(row => {
    const newRow = { Nama: row.Nama };
    for (const [tanggal, nilai] of Object.entries(row)) {
      if (tanggal === "Nama") continue;
      const t = new Date(tanggal);
      if (
        t.getFullYear() == tahun &&
        t.getMonth() + 1 == parseInt(bulan)
      ) {
        newRow[tanggal] = nilai;
      }
    }
    return newRow;
  });
  tampilkanTabel(dataFiltered);
});

function tampilkanTabel(data) {
  let html = "<tr><th>Nama</th>";
  const semuaTanggal = new Set();
  data.forEach(row => {
    Object.keys(row).forEach(k => {
      if (k !== "Nama") semuaTanggal.add(k);
    });
  });

  const tanggalList = Array.from(semuaTanggal).sort();
  tanggalList.forEach(tgl => html += `<th>${tgl}</th>`);
  html += "</tr>";

  data.forEach(row => {
    html += `<tr><td>${row.Nama}</td>`;
    tanggalList.forEach(tgl => {
      html += `<td>${row[tgl] || "‚ùå"}</td>`;
    });
    html += "</tr>`;
  });

  tabel.innerHTML = html;
}
  </script>

  <footer>
    <p>&copy; 2025 RT 05 - KKN Mahasiswa</p>
  </footer>
</body>
</html>
